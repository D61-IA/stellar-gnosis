{% extends "gnosis_theme.html" %}

{% block content %}

<div class="mt-5">
    <h3>{{ paper.title }}</h3>

    <h4>
        <a href={{ paper.download_link }} class="btn btn-primary" role="button">Download</a>
        {% if user.is_authenticated %}<a href="{% url 'paper_update' paper.id %}" class="btn btn-danger btn-sm"
                                         role="button">
        Edit</a>
        {% endif %}
    </h4>

    <h5 class="text-left">
        {{ authors }} {% if user.is_authenticated and user.is_superuser%}<a href="{% url 'paper_authors' id=paper.id %}"
                                                       class="btn btn-danger btn-sm" role="button">
        Edit</a>{% endif %}
    </h5>

    <h5 class="text-right">
        <small>keywords: {{ paper.keywords }}</small>
    </h5>

    <p><strong>Abstract:</strong> {{ paper.abstract }} </p>
    {% if venue %}
    <p>
        <small><strong>Venue:</strong> {{ venue }}</small>
    </p>
    {% endif%}

    {% if messages %}
    {% for message in messages %}
    <p class="bg-success">{{ message }}</p>
    {% endfor %}
    {% endif %}

    <h4 class="text-right">{% if user.is_authenticated %} Connect with: <a
            href="{% url 'paper_connect_paper' paper.id %}">Paper</a>
        || <a href="{% url 'paper_connect_venue' paper.id %}">Venue</a> ||
        <a href="{% url 'paper_connect_author' paper.id %}">Author</a> ||
        <a href="{% url 'paper_connect_dataset' paper.id %}">Dataset</a> ||
        <a href="{% url 'paper_connect_code' paper.id %}">Code Repo</a>{% endif %}</h4>
</div>
{% if user.is_authenticated and user.is_superuser %}
<div class="card text-left shadow-sm mb-5 mt-3">
    <div class="card-header"><strong>Admin functions</strong></div>
    <div class="card-body">
        <a href="{% url 'paper_delete' paper.id %}" class="btn btn-danger btn-sm" role="button">Delete Paper</a>
    </div>
</div>
{% endif %}
{% if codes %}
<h4>Code</h4>
<ul class="list-group">
    {% for code in codes %}
    <li class="list-group-item"><h6><a href="{{ code.get_absolute_url }}">{{ code.website }}</a></h6></li>
    {% endfor %}
</ul>
{% endif %}

<div id="cy"></div>

<p>{% if user.is_authenticated %}<a href="{% url 'comment_create' %}" class="btn btn-info btn-md">
    <span class="glyphicon glyphicon-plus"></span> Add Comment</a></p>
{% else %}
<p><a href="{% url 'login' %}?next={{request.path}}">Login</a> to comment</p>
{% endif %}
{% if num_comments > 0 %}
<div class="mt-5">
    <h3>{{ num_comments }} Comments</h3>
    <ul class="list-group">
        {% for comment in comments %}
        <li class="list-group-item mt-1">
            <p><strong>{{comment.author }}</strong> says:</p>
            <p>
                <small>{{ comment.publication_date }}</small>
            </p>
            <p>{{ comment.text }}</p>
            {% if comment.created_by == user.id %}
            <a href="{% url 'comment_update' comment.id %}">Edit</a>
            {% endif %}
        </li>
    </ul>
    {% endfor %}
</div>
{% endif %}

<script type="text/javascript">
    var cy = cytoscape({
        container: document.getElementById('cy'), // container to render in

        elements: {{ ego_network | safe }},

    style: [ // the stylesheet for the graph
        {
            selector: 'node',
            style: {
                'background-color': '#666',
                'label': 'data(title)',
                'text-wrap': 'ellipsis',
                'text-max-width': '200'
            }
        },

        {
            selector: 'edge',
            style: {
                'width': 1,
                'label': 'data(label)',
                'line-color': '#ccc',
                'target-arrow-color': '#ccc',
                'target-arrow-shape': 'triangle'
            }
        }
    ],

        layout
    :
    {
        name: 'circle',
            rows
    :
        1
    }
    })
    ;

    cy.on('tap', 'node', function (evt) {
        var node = evt.target;
        console.log('tapped ' + node.data('href'));
        try {
            window.open(node.data('href'), '_self');
        } catch (e) {
            window.location.href = node.data('href');
        }
    });

</script>

{% endblock %}